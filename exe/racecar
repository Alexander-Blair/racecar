#!/usr/bin/env ruby

require "racecar"
require "racecar/cli"

module Racecar
  class << self
    def start(argv)
      Cli.main(argv)
    rescue SignalException => e
      # We might receive SIGTERM before our signal handler is installed.
      if Signal.signame(e.signo) == "TERM"
        exit(0)
      else
        raise
      end
    rescue SystemExit
      raise
    rescue Exception => e
      $stderr.puts "=> Crashed: #{e.class}: #{e}\n#{e.backtrace.join("\n")}"

      # Racecar.config.error_handler.call(e)

      exit(1)
    else
      exit(0)
    end
  end
end

# Start your engines!
Racecar.start(ARGV)
